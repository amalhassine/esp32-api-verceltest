<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Smart Farming - ESP32</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      margin-top: 40px;
    }
    .hidden {
      display: none;
    }
    input, button {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
    }
  </style>
</head>
<body>
  <!-- Login Form -->
  <div id="loginForm">
    <h2>Connexion s√©curis√©e</h2>
    <input type="text" id="username" placeholder="Nom d'utilisateur"><br>
    <input type="password" id="password" placeholder="Mot de passe"><br>
    <button onclick="login()">Se connecter</button>
    <p id="errorMsg" style="color: red;"></p>
  </div>

  <!-- Commande Interface -->
  <div id="controlPanel" class="hidden">
    <h2>Station Smart Farming - ESP32</h2>
    <button onclick="sendCmd('pompe', 'ON')">üöø Activer Pompe</button>
    <button onclick="sendCmd('pompe', 'OFF')">üõë D√©sactiver Pompe</button><br><br>
    <button onclick="sendCmd('buzzer', 'ON')">üîî Activer Buzzer</button>
    <button onclick="sendCmd('buzzer', 'OFF')">üîï D√©sactiver Buzzer</button>
    <br><br>
    <button onclick="logout()">üîí Se d√©connecter</button>
  </div>

  <script>
    const validUsername = "admin";
    const validPassword = "esp32pass";

    // Fonction de connexion
    function login() {
      const user = document.getElementById("username").value;
      const pass = document.getElementById("password").value;
      if (user === validUsername && pass === validPassword) {
        document.getElementById("loginForm").classList.add("hidden");
        document.getElementById("controlPanel").classList.remove("hidden");
      } else {
        document.getElementById("errorMsg").innerText = "Identifiants incorrects !";
      }
    }

    // Fonction de d√©connexion
    function logout() {
      document.getElementById("controlPanel").classList.add("hidden");
      document.getElementById("loginForm").classList.remove("hidden");
    }

    // Fonction d'envoi de la commande √† l'ESP32
    async function sendCmd(component, value) {
      try {
        const response = await fetch('/api/commandes', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ [component]: value })
        });

        if (!response.ok) {
          throw new Error('Erreur dans la commande');
        }

        const result = await response.json();

        // V√©rifier si la r√©ponse contient l'√©tat de la commande
        if (result && result.state) {
          alert("‚úÖ Commande envoy√©e avec succ√®s : " + JSON.stringify(result.state));
        } else {
          alert("‚ùå Erreur : L'√©tat de la commande est introuvable.");
        }
      } catch (error) {
        alert("‚ùå Une erreur est survenue : " + error.message);
      }
    }
  </script>
</body>
</html>
